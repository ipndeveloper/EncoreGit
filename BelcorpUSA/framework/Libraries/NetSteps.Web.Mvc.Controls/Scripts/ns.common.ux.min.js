//IE sniffing (will go away in favor of compability detection)
$(function () {
    if ($.browser.msie) { $('body').addClass('IE' + parseInt($.browser.version)); }
    // Theme window display
    $(".section-SiteDesignContent").append('<div id="ThemePreview" class="' + $("link.stylesheet").attr("id") + '"></div>'); $(".SiteDesignContent #preview").addClass($("link.stylesheet").attr("id")); $("#lnkWorkstation").click(function () { if (!window["_gaq"]) return; window["_gaq"].push(["_link", this.href]) })

    $('#lnkWorkstation').click(function () {
        if (!window['_gaq'])
            return;
        window['_gaq'].push(['_link', this.href]);
    });

    $('#languagePicker,#loggedIn').hoverIntent( 
		function () { 
			$('.dropDown', this).show(); 
			$(this).addClass('hovered'); 
		}, 
		function () { 
			$('.dropDown', this).hide(); 
			$(this).removeClass('hovered'); 
		} 
    );
    responsiveAdjustments();
    $(window).resize(function () {
        responsiveAdjustments();
    });
    $("nav select").change(function () {
        window.location = $(this).find("option:selected").val();
    });
    function responsiveAdjustments() {
        if ($(window).width() < 640) $('nav').each(function (index) {
            var $nav = $(this),
                selID = 'Nav' + index,
                defaultText = $nav.attr('data-defaultText');
            if ($nav.find('#' + selID).length == 0) {
                $nav.addClass('responsiveNav');
                $('<select id="' + selID + '" class="responsiveNavDropdown" />').appendTo($nav);
                if (defaultText != null) {
                    $('<option />', {
                        'selected': 'selected',
                        'value': '',
                        'text': $nav.attr('data-defaultText')
                    }).appendTo($nav.find('select'));
                }
                $('a', $nav).each(function () {
                    var el = $(this);
                    $('<option />', {
                        'value': el.attr('href'),
                        'text': el.text()
                    }).appendTo($nav.find('select'))
                })
            }
        });
    }
    //DWS Specific
    $("body#DWS #SiteNav li.current").prev().addClass("onPrev");
    $("body#DWS #SiteNav li.current").next().addClass("onNext");
    $("body#DWS #SiteNav li:first").addClass("first");
    $("body#DWS #SiteNav li:last, #SiteNav li a.current:last").addClass("last");

    $('body#DWS input.datepicker').datepicker();

    //DWS Specific
    $("body#DWS #SiteNav li.current").prev().addClass("onPrev");
    $("body#DWS #SiteNav li.current").next().addClass("onNext");
    $("body#DWS #SiteNav li:first").addClass("first");
    $("body#DWS #SiteNav li:last, #SiteNav li a.current:last").addClass("last");

    $('body#DWS #UserInfo').hoverIntent(function () {
        $('div.dropDown', this).css('width', $(this).outerWidth()).fadeIn(200);
    }, function () {
        $('div.dropDown', this).fadeOut(500);
    });

    // hidden advanced options & searching
    $('body#DWS #globalSearchToggle').click(function () {
        $(this).next().slideToggle('fast');
        $('span.icon-navbarSearch', this).toggleClass('selected');
        return false;
    });

    $('body#DWS input.datepicker').datepicker();

    // Tabber
    $('body#DWS div.Tabber').each(function () {
        $('li:first', this).addClass('first');
        $('li:last', this).addClass('last');
    }).delegate('li', 'click', function () {
        var tabber = $(this).parent();

        $('.current', tabber).removeClass('current');
        $(this).addClass('current');

        var id = tabber.attr('id');
        if (id) {
            var t = $('.' + id);
            if (t.length)
                t.hide();
        }
        var target = $('#' + $(this).attr('rel'));
        if (target.length)
            target.css('display', 'block');
        return false;
    });
    //End DWS Specific

    // qmark
    $("a[content-qmark]").each(function(){var e=$(this).attr("content-qmark");$(this).append('<span class="qmark UI-darkBg pad10 brdr1 brdrAll">'+e+'<a href="javascript(void);" class="icon-xsm qmark_close" data-icon="&#e02a;"></a></span>')});$("a[content-qmark]").toggle(function(){$(this).find(".qmark").animate({opacity:.9,marginTop:"-15px"},200);var e=$(this).width();var t=$(this).find(".qmark").outerWidth();var n=$(this).find(".qmark").outerHeight();$(this).find(".qmark").css({"top":-n,"display":"block"})},function(){$(this).find(".qmark").animate({opacity:0,marginTop:"0px"},200);$(this).find(".qmark").css({"display":"none"})})
    //End qmArk


    // sliding nav panel
    function toggleMenu(targ) {
        var closedM = "-110%";
        var openedM = "-25%";
        if ($('#' + targ + ' ul').is(':hidden')) {
            // open
            $('#' + targ).animate({
                opacity: 1,
                right: openedM
            }, 200, function () { $('ul', this).fadeIn('fast'); });
        } else {
            // close
            $('#' + targ).animate({
                opacity: .7,
                right: closedM
            }, 200, function () { $('ul', this).hide(); });
        }
    }

    $('.menu-trig').each(function () {
        var targ = $(this).attr('data-menu');
        $(this).click(function () {
            toggleMenu(targ);
        });
    });
    $('.menu-panel a').each(function () {
        var targ = $(this).parents('div.menu-panel').attr('id');
        $(this).click(function (e) {
            e.preventDefault();
            toggleMenu(targ);
        });
    });
    // end sliding nav panel
    $('#SiteNav .inner').each(function () {
        var $liCurrent = $(this).find('li.current');
        if($liCurrent.is(':first-child')===false) {
            $('#ActiveLinkTerm').html($liCurrent.text());
        }
    });

});